/**
  Macro triggered when a thumbnail has been generated by anyone.
  Broadcast the information to people interested in it.
*/
macroscript core_conversation__onNewThumbnail(
	/** the original file previously uploaded used as base for thumbnail generation */
	object baseFile,
	/** the list of generated thumbnails */
	array thumbnails
) {
			
	/** get stored file entry from basic uploaded file information */
	var { entry: { metadata, url: file } } = zpServiceFileSystem.stat(baseFile);

	/** get conversation and owner for the generated file */
	var conversationId = metadata.conversationId;
	var owner = metadata.owner;
	
	/** update the conversation message with new thumbnails */
	var { result: { id, message, targets, thumbnails: thumbs } } = call updateConversationAttachment({ id: conversationId, owner, fileGuid: file.guid, thumbnails }) hardFail;
} broadcast(targets) { id, message, thumbnails: thumbs } on channel "updateConversationAttachment"