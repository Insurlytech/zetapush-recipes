/**
  Macro triggered when a thumbnail has been generated by anyone.
  Broadcast the information to people interested in it.
*/
macroscript onNewThumbnail(
		/** the original file previously uploaded used as base for thumbnail generation */
		object baseFile,
		/** the list of generated thumbnails */
		array thumbnails) {
			
	/** get stored file entry from basic uploaded file information */
	var uploadedFile = zpServiceFileSystem.stat(baseFile);

	/** get conversation and owner for the generated file */
	var conversationId = uploadedFile.entry.metadata.conversationId;
	var owner = uploadedFile.entry.metadata.owner;
	
	/** update the conversation message with new thumbnails */
	var response = call updateConversationAttachment({ id: conversationId, owner, fileGuid: uploadedFile.entry.url.guid, thumbnails }) hardFail;
	var targets = response.result.targets;
	var message = response.result.message;
	var id = response.result.id;
	var thumbs = response.result.thumbnails;
	
	// TODO: use reference to macro
} broadcast(targets) { id, message, thumbnails: thumbs } on channel "updateConversationAttachment"