macroscript getConversation(
	@NotNull string id,
	@NotNull string owner,
	object pagination = null
) {
	var response = null;

	/** Get user conversation */
	var resultset = @@(zpServiceDatabase) SELECT * FROM ${CONVERSATION_TABLE} WHERE id = :{id} AND owner  = :{owner};
	/** Copy first result set item */
	var details = coll:copyMap(list:first(resultset));

	// TODO Avoid sudo with a correct grants policy
	response = sudo owner call zpRecipeGroup::getGroupByService({ id, zpService: zpServiceGroups }) hardFail;
	/** Destructure resonse properties */
	var group = response.result.group;

	response = call getConversationMessages({ id, owner, pagination }) hardFail;
	/** Destructure resonse properties */
	var messages = response.result.messages;
	var page = response.result.page;

	response = call getConversationUnreadMessages({ id }) hardFail;
	/** Destructure resonse properties */
	var unread = response.result.unread;

} broadcast { details, group, messages, page, unread } on channel __selfName
